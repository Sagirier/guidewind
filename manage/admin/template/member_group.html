<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title><?php echo $GLOBALS['WP']['ext']['site_title']; ?>网站后台 - 会员分组管理</title>
    <meta name="keywords" content="<?php echo $GLOBALS['WP']['ext']['site_title']; ?>,网站后台">
    <meta name="description" content="<?php echo $GLOBALS['WP']['ext']['site_title']; ?>网站后台">
    <link href="manage/admin/template/css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="manage/admin/template/font-awesome/css/font-awesome.css?v=4.3.0" rel="stylesheet">
    <link href="manage/admin/template/css/animate.css" rel="stylesheet">
    <link href="manage/admin/template/css/style.css?v=2.2.0" rel="stylesheet">
	<link href="manage/admin/template/css/plugins/chosen/chosen.css" rel="stylesheet">
	<link href="manage/admin/template/css/plugins/iCheck/custom.css" rel="stylesheet">
	<style>
		.chosen-search{display: none;}
	</style>
</head>
<body>
    <div id="wrapper">
    	<?php include "manage/admin/template/left.html"; ?>
       	<div id="page-wrapper" class="gray-bg dashbard-1">
      	<?php include "manage/admin/template/header.html"; ?>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-9">
                    <h2>会员分组管理</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="?">主页</a>
                        </li>
                        <li><a href="?action=member">会员管理</a></li>
                        <li>
                            <strong>会员分组管理</strong>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                	<div class="col-lg-6 full-width">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h5>会员分组列表</h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 full-width">
                        <table class="table table-bordered article-table">
                			<thead>
                			<tr>
                				<td>名称</td>
                				<td>级别</td>
                				<td>允许投稿</td>
                				<td>投稿审核</td>
                				<td>文件类型</td>
                				<td>单个文件</td>
                				<td>全部文件</td>
                				<td>购物优惠</td>
                				<td>操作</td>
                			</tr>
                			</thead>
                            <tbody>
                            	<?php foreach($lists as $t){ ?>
                            	<form action="?action=member&o=group&op=edit&gid=<?php echo $t['gid']; ?>&go=1" method="post" id="membergroupedit<?php echo $t['gid']; ?>" onsubmit="return false">
                            	<tr>
                            		<td><label style="width: 100%;"><input class="form-control" id="membergroup_name<?php echo $t['gid']; ?>" type="text" value="<?php echo $t['name']; ?>" name="membergroup_name<?php echo $t['gid']; ?>" /></label></td>
                					<td>
                						<label>
                							<select class="chosen-select" name="membergroup_weight<?php echo $t['gid']; ?>">
                								<option value="1" <?php if($t['weight']==0){ echo 'selected="selected"';} ?>>无</option>
                								<option value="1" <?php if($t['weight']==1){ echo 'selected="selected"';} ?>>1级</option>
                								<option value="2" <?php if($t['weight']==2){ echo 'selected="selected"';} ?>>2级</option>
                								<option value="3" <?php if($t['weight']==3){ echo 'selected="selected"';} ?>>3级</option>
                								<option value="4" <?php if($t['weight']==4){ echo 'selected="selected"';} ?>>4级</option>
                								<option value="5" <?php if($t['weight']==5){ echo 'selected="selected"';} ?>>5级</option>
                								<option value="6" <?php if($t['weight']==6){ echo 'selected="selected"';} ?>>6级</option>
                								<option value="7" <?php if($t['weight']==7){ echo 'selected="selected"';} ?>>7级</option>
                								<option value="8" <?php if($t['weight']==8){ echo 'selected="selected"';} ?>>8级</option>
                								<option value="9" <?php if($t['weight']==9){ echo 'selected="selected"';} ?>>9级</option>
                								<option value="10" <?php if($t['weight']==10){ echo 'selected="selected"';} ?>>10级</option>
                							</select>
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="radio" form="membergroupedit<?php echo $t['gid']; ?>" class="i-checks" name="membergroup_submit<?php echo $t['gid']; ?>" value="1"<?php if($t['submit']==1){echo ' checked="checked"';} ?>> 是
                							<input type="radio" form="membergroupedit<?php echo $t['gid']; ?>" class="i-checks" name="membergroup_submit<?php echo $t['gid']; ?>" value="0"<?php if($t['submit']==0){echo ' checked="checked"';} ?>> 否
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="radio" form="membergroupedit<?php echo $t['gid']; ?>" class="i-checks" name="membergroup_audit<?php echo $t['gid']; ?>" value="1"<?php if($t['audit']==1){echo ' checked="checked"';} ?>> 是
                							<input type="radio" form="membergroupedit<?php echo $t['gid']; ?>" class="i-checks" name="membergroup_audit<?php echo $t['gid']; ?>" value="0"<?php if($t['audit']==0){echo ' checked="checked"';} ?>> 否
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="text" form="membergroupedit<?php echo $t['gid']; ?>" class="form-control" name="membergroup_filetype<?php echo $t['gid']; ?>" value="<?php echo $t['filetype']; ?>" />
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="text" form="membergroupedit<?php echo $t['gid']; ?>" class="form-control W-20 no-clip" name="membergroup_filesize<?php echo $t['gid']; ?>" value="<?php echo $t['filesize']; ?>" /> KB
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="text" form="membergroupedit<?php echo $t['gid']; ?>" class="form-control W-20 no-clip" name="membergroup_fileallsize<?php echo $t['gid']; ?>" value="<?php echo $t['fileallsize']; ?>" /> KB
                						</label>
                					</td>
                					<td>
                						<label style="width: 50%;">
                							<select form="membergroupedit<?php echo $t['gid']; ?>" class="chosen-select" name="membergroup_discount_type<?php echo $t['gid']; ?>">
                								<option value="0"<?php if($t['discount_type']==0){ echo ' selected="selected"';}?>>无优惠</option>
                								<option value="1"<?php if($t['discount_type']==1){ echo ' selected="selected"';}?>>直减</option>
                								<option value="2"<?php if($t['discount_type']==2){ echo ' selected="selected"';}?>>折扣</option>
                							</select>
                						</label>
                						<label style="margin-left: 10px;">
                							<input type="text" form="membergroupedit<?php echo $t['gid']; ?>" class="form-control W-20 no-clip" name="membergroup_discount<?php echo $t['gid']; ?>" value="<?php echo $t['discount']; ?>" /><?php if($t['discount_type']==2){ echo ' 折';}else{ echo ' 元';} ?>
                						</label>
                					</td>
                					<td>
                                        <button class="btn btn-primary" value="<?php echo $t['gid']; ?>" onclick="Layerconfirm(this);" name="<?php echo $t['name']; ?>"><i class="fa fa-check"></i> 提交</a></button>
                                        <?php if($t['sys']!=1){ ?>
                                        <span class="tooltip-demo">
                                        	<button data-original-title="系统分组无法删除" type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title=""><i class="fa fa-remove"></i> 删除</button>
                                        </span>
                                        <?php }else{ ?>
                                        <button type="button" value="<?php echo $t['gid']; ?>" class="btn btn-danger" onclick="LayerconfirmDel(this);" name="<?php echo $t['name']; ?>"><i class="fa fa-times"></i> 删除</button>
                                        <?php } ?>
                                    </td>
                            	</tr>
                            	</form>
                            	<?php }if($op=='add'){ ?>
                            	<form action="?action=member&o=group&op=add&go=1" method="post" id="membergroupadd" onsubmit="return false">
                            	<tr>
                            		<td><label style="width: 100%;"><input class="form-control" id="membergroup_name" type="text"  name="membergroup_name" /></label></td>
                					<td>
                						<label>
                							<input type="radio" form="membergroupadd" class="i-checks" name="membergroup_weight" value="1" checked="checked"> 是
                							<input type="radio" form="membergroupadd" class="i-checks" name="membergroup_weight" value="0"> 否
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="radio" form="membergroupadd" class="i-checks" name="membergroup_submit" value="1" checked="checked"> 是
                							<input type="radio" form="membergroupadd" class="i-checks" name="membergroup_submit" value="0"> 否
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="radio" form="membergroupadd" class="i-checks" name="membergroup_audit" value="1" checked="checked"> 是
                							<input type="radio" form="membergroupadd" class="i-checks" name="membergroup_audit" value="0"> 否
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="text" form="membergroupadd" class="form-control" name="membergroup_filetype" />
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="text" form="membergroupadd" class="form-control W-20 no-clip" name="membergroup_filesize" /> KB
                						</label>
                					</td>
                					<td>
                						<label>
                							<input type="text" form="membergroupadd" class="form-control W-20 no-clip" name="membergroup_fileallsize" /> KB
                						</label>
                					</td>
                					<td>
                						<label style="width: 50%;">
                							<select form="membergroupadd" class="chosen-select" name="membergroup_discount_type">
                								<option value="0" hassubinfo="true" selected="selected">无优惠</option>
                								<option value="1" hassubinfo="true">直减</option>
                								<option value="2" hassubinfo="true">折扣</option>
                							</select>
                						</label>
                						<label style="margin-left: 10px;">
                							<input type="text" form="membergroupadd" class="form-control W-20 no-clip" name="membergroup_discount" value="0.00" /> 元
                						</label>
                					</td>
                					<td>
                                        <button class="btn btn-primary" onclick="Layerconfirmadd();"><i class="fa fa-check"></i> 提交</a></button>
                                        <a href="?action=member&o=group" class="btn btn-danger"><i class="fa fa-times"></i> 取消</a></td>
                                    </td>
                            	</tr>
                            	</form>
                            	<?php } ?>
                        	</tbody>
                    	</table>
                    	<div class="clear">
	                		<a class="btn btn-primary" href="?action=member&o=group&op=add"><i class="fa fa-plus"></i> 添加会员分组</a>
	                	</div>
                	</div>
                	<div class="col-lg-6 full-width m-t-md">
                		<h5>选项说明</h5>
                		<p style="padding-left: 10px;">1.分组名称可以包含特殊字符，但不允许为空，长度不能超过20个字符（10个汉字）；</p>
                		<p style="padding-left: 10px;">2.分组级别分为10个级别，每个级别可以拥有的权限都不一样，级别越大权限越高；</p>
                		<p style="padding-left: 10px;">3.允许操作选择是，该会员分组下的会员可以操作（删除、查看）其发布的内容；</p>
                		<p style="padding-left: 10px;">4.允许投稿选择是，该会员分组下的会员可以发布自己的内容；</p>
                		<p style="padding-left: 10px;">5.投稿审核选择是，该会员分组下的会员发布的内容需要审核才能显示在网页中；</p>
                		<p style="padding-left: 10px;">6.文件类型，该会员分组下的会员允许上传的文件类型；（留空则默认为系统设置）</p>
                		<p style="padding-left: 10px;">7.单个文件，该会员分组下的会员上传单个文件不允许超过该值；（留空则默认为系统设置--10M）</p>
                		<p style="padding-left: 10px;">8.全部文件，该会员分组下的会员上传的所有文件总大小不允许超过该值；（留空则默认为系统设置--25M）</p>
                		<p style="padding-left: 10px;">9.购物优惠，选择无优惠，该会员分组下的会员在支付时不享受任何优惠；选择直减，该会员分组下的会员可以享受直接节省所设置值的金额优惠；选择折扣，该会员分组下的会员可以在支付时享受所设置值的打折优惠。</p>
                	</div>
                </div>
            </div><!--.wrapper-->
          <?php include "manage/admin/template/footer.html"; ?>
    </div><!--#page-wrapper-->
</div><!--#wrapper-->
<?php include "manage/admin/template/js.html"; ?>
    <script src="manage/admin/template/js/plugins/chosen/chosen.jquery.js"></script>
    <script>
        $(document).ready(function () {
            var elem = document.querySelector('.js-switch');
            var switchery = new Switchery(elem, {
                color: '#1AB394'
            });

            var elem_2 = document.querySelector('.js-switch_2');
            var switchery_2 = new Switchery(elem_2, {
                color: '#ED5565'
            });

            var elem_3 = document.querySelector('.js-switch_3');
            var switchery_3 = new Switchery(elem_3, {
                color: '#1AB394'
            });

        });
        var config = {
            '.chosen-select': {},
            '.chosen-select-deselect': {
                allow_single_deselect: true
            },
            '.chosen-select-no-single': {
                disable_search_threshold: 10
            },
            '.chosen-select-no-results': {
                no_results_text: 'Oops, nothing found!'
            },
            '.chosen-select-width': {
                width: "100%"
            }
        }
        for (var selector in config) {
            $(selector).chosen(config[selector]);
        }
    </script>
	 <!-- i-checks -->
    <script src="manage/admin/template/js/plugins/iCheck/icheck.min.js"></script>
    <script type="text/javascript">
    	//i-checks
    	$('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });
    </script>
    <script src="manage/admin/template/js/plugins/layer/layer.min.js" type="text/javascript"></script>
    <script src="system/js/wpfrom.js" type="text/javascript"></script>
    <script type="text/javascript">
    	function Layerconfirm(id){
    		var name=id.name;
    		$.layer({
                area: ['auto','auto'],
                title: '系统提示',
                closeBtn: false,
                dialog: {
                    msg: '确定要修改 [<font color="#337AB7">'+name+'</font>]？',
                    btns: 2,
                    type: 4,
                    btn: ['确定','取消'],
                    yes: function(){
                    	var tname=document.getElementById("membergroup_name"+id.value).value;
                    	if(!from_null(tname)){
                    		layer.alert("会员分组名称不能为空");return false;
                    	}
                    	if(!from_max(tname,20)){
                    		layer.alert("会员分组名称不能超过20个字符（10个汉字以内）");return false;
                    	}
                    	document.getElementById("membergroupedit"+id.value).submit();
                    }, no: function(){
                        return false;
                    }
                }
            });
		}
    	function Layerconfirmadd(){
    		$.layer({
                area: ['auto','auto'],
                title: '系统提示',
                closeBtn: false,
                dialog: {
                    msg: '确定要添加该会员分组？',
                    btns: 2,
                    type: 4,
                    btn: ['确定','取消'],
                    yes: function(){
                    	var tname=document.getElementById("membergroup_name").value;
                    	if(!from_null(tname)){
                    		layer.alert("会员分组名称不能为空");return false;
                    	}
                    	if(!from_max(tname,20)){
                    		layer.alert("会员分组名称不能超过20个字符（10个汉字以内）");return false;
                    	}
                    	document.getElementById("membergroupadd").submit();
                    }, no: function(){
                        return false;
                    }
                }
            });
		}
    	function LayerconfirmDel(id){
    		var name=id.name;
    		$.layer({
                area: ['auto','auto'],
                title: '系统提示',
                closeBtn: false,
                dialog: {
                    msg: '<font color="#F00"><i class="fa fa-exclamation-circle"></i></font> 删除分组时，必须确保该分组下<font color="#F00">无任何会员</font>!<br/>确定要删除 [<font color="#337AB7">'+name+'</font>]？<br/>该操作不可逆，建议删除前备份数据库！',
                    btns: 2,
                    type: 4,
                    btn: ['确定','取消'],
                    yes: function(){
                    	window.location.href="?action=member&o=group&op=del&gid="+id.value;
                    }, no: function(){
                        return false;
                    }
                }
            });
    	}
    </script>
</body>
</html>
